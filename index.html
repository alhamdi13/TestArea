<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absensi Karyawan - Restoran F&B</title>
    <!-- Memuat Font Awesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset CSS dasar dan pengaturan font global */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Variabel warna CSS untuk tema */
        :root {
            --primary: #1e3a8a;
            --primary-dark: #1e40af;
            --secondary: #059669;
            --accent: #f59e0b;
            --light: #f8fafc;
            --dark: #0f172a;
            --gray: #94a3b8;
            --success: #10b981;
            --danger: #ef4444;
        }

        /* Pengaturan body utama */
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }

        /* Kontainer utama untuk membatasi lebar konten */
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Header dengan logo dan judul */
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--accent);
        }

        .logo h1 {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(to right, #fbbf24, #f59e0b, #ef4444);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .logo p {
            color: var(--gray);
            font-size: 1.1rem;
        }

        /* Styling untuk kartu (card) */
        .card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px); /* Efek glassmorphism */
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #e2e8f0;
        }

        .card-title i {
            color: var(--accent);
        }

        /* Styling untuk indikator langkah (steps) */
        .steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            position: relative;
        }

        /* Garis penghubung antar langkah */
        .steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 15%;
            right: 15%;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--accent), var(--secondary));
            z-index: 1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
            position: relative;
        }

        .step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #334155;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 10px;
            border: 3px solid #475569;
            transition: all 0.3s ease;
        }

        /* Status langkah: aktif */
        .step.active .step-circle {
            background: var(--primary);
            border-color: var(--accent);
            color: white;
            transform: scale(1.1);
        }

        /* Status langkah: selesai */
        .step.completed .step-circle {
            background: var(--secondary);
            border-color: var(--success);
            color: white;
        }

        .step-label {
            font-size: 0.9rem;
            color: #94a3b8;
            text-align: center;
        }

        .step.active .step-label,
        .step.completed .step-label {
            color: white;
            font-weight: 600;
        }

        /* Kontainer untuk video kamera */
        .camera-container {
            position: relative;
            margin: 20px auto;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            background: #0f172a;
            aspect-ratio: 4/5; /* Rasio aspek untuk tampilan potret */
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        #canvas {
            display: none; /* Canvas disembunyikan, hanya untuk mengambil gambar */
        }

        /* Pratinjau selfie */
        .selfie-preview {
            display: none;
            text-align: center;
        }

        .selfie-preview img {
            max-width: 100%;
            border-radius: 12px;
            margin: 15px 0;
            border: 3px solid var(--secondary);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* Info lokasi */
        .location-info {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--accent);
        }

        .location-info h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--accent);
        }

        .location-info p {
            margin: 8px 0;
            color: #cbd5e1;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .location-info i {
            color: var(--secondary);
            width: 20px;
        }

        /* Styling tombol */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            width: 100%;
            margin-top: 20px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(30, 58, 138, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--secondary), #047857);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(5, 150, 105, 0.4);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent), #d97706);
            color: white;
        }

        .btn-accent:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(245, 158, 11, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Styling untuk kotak hasil (sukses atau error) */
        .result {
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            margin-top: 20px;
            display: none; /* Sembunyi secara default */
        }

        .result.success {
            background: rgba(5, 150, 105, 0.2);
            border: 2px solid var(--success);
        }

        .result.error {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid var(--danger);
        }

        .result i {
            font-size: 3.5rem;
            margin-bottom: 20px;
        }

        .result.success i {
            color: var(--success);
        }

        .result.error i {
            color: var(--danger);
        }

        .result h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .result p {
            font-size: 1.1rem;
            color: #e2e8f0;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Info karyawan */
        .employee-info {
            display: flex;
            align-items: center;
            gap: 20px;
            background: rgba(15, 23, 42, 0.5);
            padding: 20px;
            border-radius: 15px;
            margin-top: 25px;
        }

        .employee-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            flex-shrink: 0;
        }

        .employee-details h3 {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .employee-details p {
            color: var(--gray);
            font-size: 0.95rem;
        }

        /* Badge status */
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 8px; /* Tambahan margin */
        }

        .status-in {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 40px;
            color: var(--gray);
            font-size: 0.9rem;
            padding: 20px;
        }

        /* Media query untuk perangkat mobile */
        @media (max-width: 768px) {
            .steps {
                flex-wrap: wrap;
                gap: 15px;
            }

            .steps::before {
                display: none; /* Sembunyikan garis di mobile */
            }

            .step {
                flex: 1 1 45%; /* Buat jadi 2 kolom */
            }

            .employee-info {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-utensils"></i>
                <div>
                    <h1>RESTORAN SAVORY</h1>
                    <p>Sistem Absensi Karyawan F&B</p>
                </div>
            </div>
        </header>

        <!-- Kartu Info Karyawan -->
        <div class="card">
            <div class="employee-info">
                <div class="employee-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="employee-details">
                    <h3>Ahmad Fauzi</h3>
                    <p>Staff Kitchen • ID: EMP-2023-087</p>
                    <span class="status-badge status-in">Status: Masuk Hari Ini</span>
                </div>
            </div>
        </div>

        <!-- Kartu Ambil Selfie -->
        <div class="card">
            <h2 class="card-title"><i class="fas fa-camera"></i> Ambil Selfie untuk Absensi</h2>
            
            <!-- Indikator Langkah -->
            <div class="steps">
                <div class="step active" id="step1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Buka Kamera</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Ambil Selfie</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Verifikasi Wajah</div>
                </div>
                <div class="step" id="step4">
                    <div class="step-circle">4</div>
                    <div class="step-label">Lokasi & Submit</div>
                </div>
            </div>

            <!-- Tampilan Kamera -->
            <div class="camera-container">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas"></canvas>
            </div>

            <!-- Pratinjau Selfie -->
            <div class="selfie-preview" id="selfiePreview">
                <h3>Selfie Anda</h3>
                <img id="selfieImage" src="" alt="Selfie Preview">
            </div>

            <!-- Tombol Aksi Kamera -->
            <button id="startCamera" class="btn btn-primary">
                <i class="fas fa-video"></i> Mulai Kamera
            </button>
            <button id="takeSelfie" class="btn btn-accent" disabled>
                <i class="fas fa-camera"></i> Ambil Selfie
            </button>
            <button id="verifyFace" class="btn btn-success" disabled>
                <i class="fas fa-user-check"></i> Verifikasi Wajah
            </button>
        </div>

        <!-- Kartu Lokasi & Submit -->
        <div class="card">
            <h2 class="card-title"><i class="fas fa-map-marker-alt"></i> Lokasi & Submit Absensi</h2>
            
            <!-- Info Lokasi -->
            <div class="location-info" id="locationInfo">
                <h3><i class="fas fa-info-circle"></i> Informasi Lokasi</h3>
                <p id="locationStatus"><i class="fas fa-spinner fa-spin"></i> Mendeteksi lokasi...</p>
                <p id="latitudeInfo"><i class="fas fa-globe"></i> Latitude: -</p>
                <p id="longitudeInfo"><i class="fas fa-globe"></i> Longitude: -</p>
                <p id="accuracyInfo"><i class="fas fa-bullseye"></i> Akurasi: -</p>
                <p id="addressInfo"><i class="fas fa-map-pin"></i> Lokasi: -</p>
            </div>

            <!-- Tombol Aksi Lokasi & Submit -->
            <button id="getLocation" class="btn btn-primary">
                <i class="fas fa-location-arrow"></i> Dapatkan Lokasi Sekarang
            </button>
            <button id="submitAttendance" class="btn btn-success" disabled>
                <i class="fas fa-check-circle"></i> Submit Absensi
            </button>
        </div>

        <!-- Hasil Sukses -->
        <div class="result success" id="resultSuccess">
            <i class="fas fa-check-circle"></i>
            <h2>Absensi Berhasil!</h2>
            <p>Selamat datang di Restoran Savory, Ahmad. Absensi Anda telah tercatat pada pukul <span id="timeSuccess">-</span> dengan lokasi <span id="locationSuccess">-</span>.</p>
        </div>

        <!-- Hasil Error -->
        <div class="result error" id="resultError">
            <i class="fas fa-exclamation-triangle"></i>
            <h2>Absensi Gagal</h2>
            <p id="errorMessage">Terjadi kesalahan saat memproses absensi. Pastikan kamera dan lokasi diaktifkan.</p>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>© 2025 Restoran Savory • Sistem Absensi Karyawan F&B • Versi 1.0</p>
            <p style="margin-top: 8px; font-size: 0.8rem; color: #64748b;">
                <i class="fas fa-shield-alt"></i> Data absensi aman & terenkripsi
            </p>
        </div>
    </div>

    <script>
        // Mengambil elemen-elemen DOM
// ... existing code ... */
        const errorMessage = document.getElementById('errorMessage');

        // Variabel untuk menyimpan state
// ... existing code ... */
        let faceVerified = false;

        // Array untuk manajemen langkah
// ... existing code ... */
            { id: 'step4', btn: submitAttendanceBtn }
        ];

        // Fungsi untuk memperbarui tampilan langkah
// ... existing code ... */
            });
        }

        // Event listener untuk tombol "Mulai Kamera"
// ... existing code ... */
                resultSuccess.style.display = 'none';
            }
        });

        // Event listener untuk tombol "Ambil Selfie"
// ... existing code ... */
            updateStep(2); // Pindah ke langkah 3
        });

        // Event listener untuk tombol "Verifikasi Wajah" (Simulasi)
// ... existing code ... */
            }, 1500); // Waktu simulasi 1.5 detik
        });

        // Fungsi untuk mendapatkan lokasi
        function getLocation() {
// ... existing code ... */
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
// ... existing code ... */
                        locationStatus.innerHTML = '<i class="fas fa-check-circle" style="color: #10b981;"></i> Lokasi berhasil dideteksi';
                        
                        resolve(locationData);
                    },
                    (error) => {
                        // FIX: Perbarui console.error untuk menampilkan pesan dan kode error yang lebih jelas
                        console.error(`Geolocation error (Code: ${error.code}): ${error.message}`);
                        let message = 'Gagal mendeteksi lokasi.';
                        switch(error.code) {
// ... existing code ... */
                            case error.TIMEOUT:
                                message = 'Waktu permintaan lokasi habis.';
                                break;
                        }
                        locationStatus.innerHTML = `<i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i> ${message}`;
                        reject(new Error(message));
                    },
                    {
// ... existing code ... */
                );
            });
        }

        // Event listener untuk tombol "Dapatkan Lokasi"
// ... existing code ... */
                });
        });

        // Event listener untuk tombol "Submit Absensi"
// ... existing code ... */
            }, 2000); // Simulasi waktu submit 2 detik
        });

        // Inisialisasi: Coba dapatkan lokasi saat halaman dimuat
        window.addEventListener('load', () => {
            // Auto-get lokasi setelah 1 detik
            setTimeout(() => {
                getLocation()
                    .then(() => {
                        getLocationBtn.disabled = true;
                    })
                    .catch((err) => {
                        // FIX: Tambahkan log peringatan jika auto-get lokasi gagal
                        console.warn('Gagal mendapatkan lokasi secara otomatis saat memuat:', err.message);
                        // Biarkan tombol tetap aktif jika gagal
                        getLocationBtn.disabled = false;
                    });
            }, 1000);
        });

        // Cleanup: Matikan kamera jika pengguna menutup tab
// ... existing code ... */
    </script>
</body>
</html>
